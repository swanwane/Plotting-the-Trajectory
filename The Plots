restart;
T := (1/2)*m*((diff(r(t), t))^2+r(t)^2*(diff(phi(t), t))^2); 
V := -G*M*m/r(t)-0.2e-1/r(t)^3;
L := T-V;
L1 := subs({diff(phi(t), t) = var4, diff(r(t), t)= var2, phi(t) = var3, r(t) = var1}, L);
Epr11 := diff(L1, var4);
Epr12 := diff(L1, var3);
Epr13 := subs({var1 = r(t), var2 = diff(r(t), t),var3 = phi(t), var4 = diff(phi(t), t)}, Epr11);
Eq14 := Epr13 = l;
Epr21 := diff(L1, var2);
Epr22 := diff(L1, var1);
Epr23 := subs({var1 = r(t), var2 = diff(r(t), t),var3 = phi(t), var4 = diff(phi(t), t)}, Epr21);
Epr24 := subs({var1 = r(t), var2 = diff(r(t), t),var3 = phi(t), var4 = diff(phi(t), t)}, Epr22);
Epr25 := diff(Epr23, t);
Eq26 := Epr25-Epr24 = 0;
Eq31 := isolate(Eq14, diff(phi(t), t));
Eq32 := eval(Eq26, Eq31);
with(plots);
G := 1; M := 1; m := 1;
Eq41 := r(0) = 1;
Eq42 := (D(r))(0) = 0;
Eq43 := phi(0) = 0;
Eq44 := (D(phi))(0) = 1.3;
En := eval(T+V, {diff(phi(t), t) = rhs(Eq44), diff(r(t), t) = rhs(Eq42), r(t) = rhs(Eq41)});
l := eval(lhs(Eq14), {diff(phi(t), t) = rhs(Eq44), r(t) = rhs(Eq41)});
\epsilon;` := sqrt((2*En*l^2+1)/m(G*M*m)^2);
ini1 := Eq41, Eq42, Eq43;
Eq51 := dsolve({Eq31, Eq32, ini1}, {phi(t), r(t)}, numeric, output = listprocedure);
polarplot([rhs(Eq51(t)[3]), rhs(Eq51(t)[2]), t = -Pi .. 100*Pi], scaling = constrained, thickness = 3, color = red, axesfont = ["HELVETICA", "ROMAN", 14]);
